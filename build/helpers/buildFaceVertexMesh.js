// Generated by CoffeeScript 1.9.0
(function() {
  var OctreeHelper, Vector;

  Vector = require('./../primitives/Vector');

  OctreeHelper = require('./OctreeHelper');

  module.exports = function(faces, options) {
    var face, faceNormals, faceVertexIndices, indices, octree, pointDistanceEpsilon, vertexCoordinates, vertexNormals, _i, _len;
    if (options == null) {
      options = {};
    }
    pointDistanceEpsilon = options.pointDistanceEpsilon || 0.0001;
    faceNormals = [];
    faceVertexIndices = [];
    octree = new OctreeHelper(pointDistanceEpsilon);
    for (_i = 0, _len = faces.length; _i < _len; _i++) {
      face = faces[_i];
      indices = [-1, -1, -1];
      face.vertices.every(function(vertex, i) {
        var index;
        index = octree.add(vertex, face.normal);
        indices[i] = index;
        return i < 2;
      });
      faceVertexIndices = faceVertexIndices.concat(indices);
      faceNormals.push(face.normal.x);
      faceNormals.push(face.normal.y);
      faceNormals.push(face.normal.z);
    }
    vertexCoordinates = octree.getVertexCoordinateList();
    vertexNormals = octree.getAveragedNormalList();
    return {
      verticesCoordinates: vertexCoordinates,
      facesVerticesIndices: faceVertexIndices,
      verticesNormals: vertexNormals,
      facesNormals: faceNormals
    };
  };

}).call(this);
